<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <title>Edit Blog</title>
</head>
<body>
    <div class="m-10">
        <div class="border rounded-lg h-full p-10">
            <div class="flex justify-between items-center">
                <p class="text-4xl font-bold">Edit</p>
                <a href="index.html" class="font-medium">Kembali</a>
            </div>
            <div id="formEdit">
                <form action="" id="editform">
                    <label for="editTitle" class="block mb-2 text-lg font-medium text-gray-900 dark:text-black mt-10">Title</label>
                    <input type="text" name="editTitle" id="editTitle" aria-describedby="helper-text-explanation" class="bg-white border border-black text-black text-md rounded-lg focus:ring-black focus:border-black block w-full p-2.5 dark:bg-white dark:border-black dark:placeholder-gray-500 dark:text-black dark:focus:ring-black dark:focus:border-black" placeholder="your title...">
                    <div id="editTitleError" class="hidden text-red-600 text-sm mt-1">Title harus diisi dan minimal 3 karakter</div>

                    <label for="editBlog" class="block mb-2 text-lg font-medium text-gray-900 dark:text-black mt-10">Your blog</label>
                    <textarea id="editBlog" name="editBlog" rows="4" class="block p-2.5 w-full text-md text-black bg-white rounded-lg border border-black focus:ring-black focus:border-black" placeholder="Write your thoughts here..."></textarea>
                    <div id="editBlogError" class="hidden text-red-600 text-sm mt-1">Blog harus diisi dan minimal 10 karakter</div>
                    
                    <button type="submit" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800 mt-10">Update</button>    
                </form>
            </div>  
        </div>  
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const blogs = JSON.parse(localStorage.getItem("Blog")) || [];
            const editId = localStorage.getItem("editId");

            console.log("Edit ID:", editId);
            console.log("Blogs:", blogs);

            const blogToEdit = blogs.find(b => b.id == editId);

            if (blogToEdit) {
                document.getElementById("editTitle").value = blogToEdit.title;
                document.getElementById("editBlog").value = blogToEdit.blog;
                console.log("Blog ditemukan :", blogToEdit);
            } else {
                console.log("Blog tidak ditemukan");
                alert("Blog tidak ditemukan!");
                window.location.href = "index.html";
                return;
            }

            // Tambahkan event listener untuk validasi real-time
            document.getElementById("editTitle").addEventListener("blur", function() {
                validateForm("editTitle");
            });

            document.getElementById("editBlog").addEventListener("blur", function() {
                validateForm("editBlog");
            });

            document.getElementById("editform").addEventListener("submit", function (e) {
                e.preventDefault();
                console.log("Form submitted");
                
                const newTitle = document.getElementById("editTitle").value.trim();
                const newBlog = document.getElementById("editBlog").value.trim();
                
                // Validasi sebelum submit
                const isTitleValid = validateForm("editTitle");
                const isBlogValid = validateForm("editBlog");
                
                if (!isTitleValid || !isBlogValid) {
                    alert("Title dan Blog harus diisi terlebih dahulu!");
                    return;
                }
                
                if (blogToEdit) {
                    blogToEdit.title = newTitle;
                    blogToEdit.blog = newBlog;
                    
                    const updatedBlogs = blogs.map(b => (b.id == editId ? blogToEdit : b));
                    
                    console.log("Updated blogs array:", updatedBlogs);
                    
                    localStorage.setItem("Blog", JSON.stringify(updatedBlogs));
                    localStorage.removeItem("editId");
                    
                    alert("Menyimpan perubahan...");
                    console.log("Redirecting to index.html");
                    window.location.href = "index.html";
                } else {
                    alert("Blog tidak ditemukan!");
                }
            });
        });

        function validateForm(fieldId){
            const field = document.getElementById(fieldId);
            const value = field.value.trim();
            const errorElement = document.getElementById(fieldId + "Error");

            if(value === ""){
                field.style.borderColor = "red";
                field.style.borderWidth = "2px";
                errorElement.classList.remove("hidden");
                return false;
            }else if(fieldId === "editTitle" && value.length < 3){
                field.style.borderColor = "red";
                field.style.borderWidth = "2px";
                errorElement.classList.remove("hidden");
                return false;
            }else if(fieldId === "editBlog" && value.length < 10){
                field.style.borderColor = "red";
                field.style.borderWidth = "2px";
                errorElement.classList.remove("hidden");
                return false;
            }else{
                field.style.borderColor = "black";
                field.style.borderWidth = "1px";
                errorElement.classList.add("hidden");
                return true;
            }
        }
    </script>
</body>
</html>